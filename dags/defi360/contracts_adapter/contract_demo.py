'''
@Project ：defi-up
@File    ：contract.py
@Author  ：Nick
@Date    ：2022/2/17 11:59 上午
'''
import pydash
import web3
from web3 import Web3

from defi360.utils.multicall import Call, Multicall, multi_call, load_abi


def from_wei(value):
    return value / 1e18


def get_token_ids(tt):
    return [e for e in tt[0]] if tt and len(tt[0]) else []


def multicall():
    # assuming you are on kovan
    w3 = web3.main.Web3(
        Web3.HTTPProvider('https://small-damp-tree.quiknode.pro/b9c72a1e111bed57e6029bfeb003eddb0e73bb70/'))  # main

    IZUMI_POOL_ADDRESS = '0x8981c60ff02CDBbF2A6AC1a9F150814F9cF68f62'  # eth
    UNIV3_NFT_ADDRSS = '0xc36442b4a4522e871399cd717abdd847ab11fe88'  # eth

    user_ids = ['0x768f2a7ccdfde9ebdfd5cea8b635dd590cb3a3f1', '0x8b4ca45f8be1beb4db2145aa28f575434f92a040']
    calls = []
    for ud in user_ids:
        calls.append(Call(IZUMI_POOL_ADDRESS, ['getTokenIds(address)(uint256[])', ud]))
    multi = Multicall(calls, w3)

    # multi()  # {'whale': 566437.0921992733, 'fish': 7005.0, 'supply': 1000003.1220798912}
    res = multi()
    token_ids = pydash.flatten(pydash.map_(res, 'output'))
    print(res)
    print(token_ids)

    calls = []
    for td in token_ids:
        calls.append(Call(UNIV3_NFT_ADDRSS, [
            'positions(uint256)((uint96,address,address,address,uint24,int24,int24,uint128,uint256,uint256,uint128,uint128))',
            td]))
    res2 = Multicall(calls, w3)()
    print(res2)


def multicall_v2():

    univ3_abi = load_abi('defi360/contracts_adapter/abi/univ3.json', 'positions')
    izumi_abi = load_abi('defi360/contracts_adapter/abi/izumi.json', 'getTokenIds')

    IZUMI_POOL_ADDRESS = '0x8981c60ff02CDBbF2A6AC1a9F150814F9cF68f62'  # eth
    UNIV3_NFT_ADDRSS = '0xc36442b4a4522e871399cd717abdd847ab11fe88'  # eth

    user_ids = ['0x768f2a7ccdfde9ebdfd5cea8b635dd590cb3a3f1', '0x8b4ca45f8be1beb4db2145aa28f575434f92a040', '0x0a29d477afd2b827182f447d38e919b19d2641c3']
    # calls = pydash.map_(user_ids, lambda ud: {
    #     'target': IZUMI_POOL_ADDRESS,
    #     'params': ud,
    # })
    # print('debug calls ', calls)
    # res = multi_call(calls, izumi_abi)
    # token_ids = pydash.flatten(pydash.map_(res, 'output'))
    # print('call res', res)
    # print('token_ids', token_ids)

    token_ids = [47068]

    calls2 = pydash.map_(token_ids, lambda td: {
        'target': UNIV3_NFT_ADDRSS,
        'params': td,
    })
    res2 = multi_call(calls2, univ3_abi, block=24754493, chain='Polygon')
    print(res2)

def multicall_v3():

    abi = load_abi('defi360/contracts_adapter/abi/erc20.json', 'balanceOf')

    user_ids = ['0x16cc37d06fe5061cd0023fb8d142abaabb396a2b', '0x0dfa9701a0875dd16f505f657dff4cb30c50d67a']
    calls = pydash.map_(user_ids, lambda ud: {
        'target': '0xaa89cab926dcd65b3779aa98d9342fd9a21e5d1c',
        'params': ud,
    })
    calls.append({
        'target': '0xc9f93163c99695c6526b799ebca2207fdf7d61ad',
        'params': '0x768f2a7ccdfde9ebdfd5cea8b635dd590cb3a3f1',
    })
    res = multi_call(calls, abi)
    print(res)

def multicall_v4():

    univ3_abi = load_abi('defi360/contracts_adapter/abi/univ3.json', 'positions')
    UNIV3_NFT_ADDRSS = '0xc36442b4a4522e871399cd717abdd847ab11fe88'  # eth
    token_ids = [46146, 46192, 44599, 45772, 35925, 35938, 36785, 35933, 35996, 36187, 59031, 37938, 37952, 37359, 37425, 43171, 57247, 41581, 58666, 43098, 43064, 41747, 43120, 33665, 33917, 29984, 29954, 29186, 60799, 41029, 34576, 34636, 34637, 35502, 49104, 49170, 49185, 51094, 48705, 49020, 49029, 48813, 34212, 48413, 57175, 55450, 55386, 27807, 27762, 28047, 28004, 52814, 52543, 52451, 46801, 46519, 59375, 46751, 46796, 50436, 44212, 50606, 47640, 50550, 59155, 27511, 27367, 44714, 43618, 44118, 43342, 43341, 43336, 44061, 44459, 44582, 58888, 40218, 44310, 60881, 38307, 46125, 45689, 45698, 45419, 46097, 36779, 36671, 36680, 38493, 35761, 38384, 35173, 39185, 36740, 37648, 37665, 38648, 41359, 41453, 41904, 43251, 57898, 56794, 59008, 27266, 29947, 29944, 29854, 29044, 29182, 39805, 39824, 39825, 39755, 41180, 34619, 34807, 34808, 34971, 34964, 34530, 48574, 34828, 34897, 58126, 49043, 48936, 48146, 41097, 57101, 57422, 45985, 27983, 27873, 27990, 52902, 53066, 53088, 51714, 52507, 47231, 47241, 46721, 46913, 46870, 46874, 35354, 46466, 47406, 45420, 43872, 49798, 49766, 50437, 38965, 38973, 50885, 47202, 58951, 27496, 27301, 27478, 52910, 26534, 44220, 44798, 44431, 44430, 44050, 43675, 43769, 45790, 45377, 45390, 36715, 36866, 43181, 34210, 36078, 35951, 36240, 34654, 36182, 35940, 36852, 36022, 41969, 41475, 36672, 60239, 29861, 29134, 40602, 39774, 58914, 39984, 34470, 34909, 61017, 46600, 47873, 49348, 49305, 27706, 27860, 27783, 27940, 48726, 45655, 47535, 46451, 50472, 50505, 38969, 49780, 58938, 25838, 27278, 27358, 60165, 60166, 60170, 56300, 57090, 61644, 56001, 56475, 56202, 55767, 56049, 58926, 57143, 55670, 55973, 57203, 59351, 59521, 56295, 55982, 55943, 55966, 55983, 58894, 57102, 60822, 56272, 22958, 24398, 24418, 23507, 18468, 18304, 59874, 49225, 57475, 47597, 52204, 60614, 60616, 49536, 56256, 47682, 48746, 47215, 47442, 60786, 61339, 57036, 47090, 54061, 48515, 61146, 52111, 54085, 58337, 61072, 53011, 61149, 47730, 47257, 50422, 61200, 60136, 48927, 46713, 48954, 47186, 59413, 48443, 50425, 59416, 46726, 46937, 48727, 48995, 56089, 49171, 47394, 47420, 50761, 58933, 60574, 49466, 49478, 48853, 54205, 57387, 51215, 60760, 49255, 49259, 49359, 51164, 55699, 60840, 48981, 56397, 49222, 47422, 46447, 56522, 49166, 49616, 58116, 50622, 47114, 47082, 54068, 54526, 58154, 48503, 50821, 54164, 50587, 50779, 55265, 57045, 58163, 60369, 55633, 47075, 61738, 53943, 55942, 49582, 56557, 57170, 49383, 52859, 59050, 47043, 41853, 46573, 41955, 50440, 47308, 51095, 48806, 50380, 27541, 60365, 53028, 45370, 44583, 44308, 43419, 36216, 45776, 45629, 45468, 60110, 35016, 38396, 34984, 37315, 37920, 58895, 37418, 41470, 29951, 29957, 29945, 26950, 29079, 39953, 39886, 40834, 40608, 35480, 58952, 35243, 49756, 49483, 47156, 49030, 45337, 36042, 36062, 48075, 48433, 48494, 48942, 56438, 28105, 27777, 27855, 47537, 47281, 44208, 46738, 46750, 50551, 33962, 51045, 50599, 50406, 50270, 38968, 27355, 27423, 27291, 59229, 56327, 26238, 44751, 33467, 44593, 44685, 44189, 44202, 44800, 44433, 44586, 46194, 45416, 46087, 45667, 45868, 44786, 45598, 36298, 49093, 35494, 35496, 35367, 38716, 42158, 42162, 40078, 41852, 37741, 41374, 41458, 41427, 42797, 59895, 33463, 33539, 33973, 29896, 29135, 29217, 29293, 39599, 39600, 39611, 40785, 60628, 40731, 40516, 61824, 40000, 57276, 34216, 35260, 34577, 34162, 34834, 35559, 50827, 43871, 43899, 46404, 49164, 47702, 55421, 56234, 27748, 27926, 27733, 35203, 51810, 46632, 46851, 46766, 46879, 46936, 47288, 47305, 47020, 47148, 46672, 47164, 47238, 50401, 49768, 40921, 51088, 50363, 50718, 50831, 50537, 58741, 25899, 25644, 55398, 40231, 44699, 35176, 35155, 44398, 44120, 43068, 44580, 44755, 44415, 44669, 44639, 43732, 44416, 45208, 36711, 40477, 45508, 45869, 45703, 45500, 45663, 59267, 46025, 52310, 35799, 60693, 45942, 58920, 35845, 35905, 35885, 36093, 37714, 37719, 39133, 38911, 37579, 42723, 57209, 40042, 41972, 42189, 41441, 48832, 55158, 33780, 29939, 29979, 29931, 30001, 40405, 40655, 40207, 34264, 34281, 49324, 35349, 34624, 34865, 48897, 48903, 49014, 49112, 49296, 45162, 51141, 27862, 27931, 28143, 27961, 48568, 52867, 52801, 52726, 46826, 46395, 46407, 46583, 45418, 45448, 46513, 46621, 50527, 50487, 50382, 50685, 23227, 58866, 57228, 52641, 27234, 27167, 27557, 50753, 26309, 38044, 43797, 44753, 44112, 44231, 44750, 56108, 33444, 45741, 45848, 43582, 34015, 35232, 46374, 34992, 35379, 36442, 42814, 60702, 41917, 59694, 33547, 29866, 29862, 29277, 29233, 51453, 40556, 39234, 39999, 48100, 39438, 35071, 35075, 35321, 34684, 34934, 34941, 35463, 57942, 49467, 49024, 49035, 49098, 48934, 49026, 50995, 49339, 48154, 23450, 23435, 33627, 36798, 28127, 28077, 27930, 28081, 27658, 53583, 46765, 46784, 47204, 44817, 46410, 46415, 47285, 45757, 44163, 59323, 47212, 51374, 50931, 50370, 50333, 50407, 50393, 49297, 59232, 32600, 27200, 27344, 27387, 60472, 53941, 48524, 50268, 44108, 44316, 44592, 44049, 35127, 44353, 44664, 49501, 44262, 43883, 45749, 43855, 46061, 32437, 58348, 25906, 27486, 27441, 27321, 54330, 54483, 53837, 55961, 45022, 41243, 43696, 44735, 43841, 43913, 44682, 43958, 41307, 45425, 45287, 45301, 36774, 36615, 36627, 36407, 36586, 34524, 37233, 37846, 37853, 57124, 38490, 37985, 43206, 57631, 39674, 41721, 40228, 42266, 59674, 59680, 54944, 31921, 29852, 29920, 29073, 40065, 34093, 39887, 39919, 35536, 35548, 35403, 34846, 35179, 34494, 34985, 48819, 48728, 48838, 48629, 49095, 49111, 49142, 46611, 48254, 48248, 27776, 28112, 28137, 27644, 28086, 46577, 46606, 47147, 46564, 46591, 46705, 46541, 58845, 51122, 50381, 50910, 51103, 51229, 58280, 60771, 38977, 23782, 59269, 27298, 27380, 27315, 60408, 31960, 52978, 43827, 38129, 50651, 44199, 44687, 43951, 57145, 44417, 44177, 41915, 41937, 44670, 45260, 46062, 45564, 45579, 45723, 36007, 35808, 36156, 34867, 37421, 40614, 37177, 38956, 38998, 34570, 42267, 41440, 41471, 42525, 42572, 41584, 42319, 41477, 29882, 29938, 29048, 29199, 29061, 40126, 40526, 58216, 34428, 39928, 39415, 39428, 40995, 41006, 40692, 40057, 33884, 34698, 34999, 33450, 35287, 35342, 35062, 33447, 49300, 48725, 48137, 47995, 50111, 49156, 24545, 54914, 28135, 27834, 27839, 27987, 27824, 27771, 27970, 46643, 44626, 46190, 47048, 47059, 47562, 44575, 49802, 50386, 45827, 50488, 50593, 50515, 42391, 27378, 27547, 27611, 60743, 54006, 54020, 44312, 44574, 44606, 44860, 41299, 43973, 44062, 44667, 44272, 53159, 36000, 36016, 36044, 34297, 58084, 37261, 37319, 38160, 37323, 33546, 59899, 42206, 41934, 35148, 41551, 42604, 42623, 33587, 29851, 29940, 29949, 29898, 29106, 24366, 24360, 40983, 40992, 40736, 41001, 34537, 46631, 35117, 34544, 33464, 49461, 49192, 49205, 49633, 45055, 49146, 49357, 48093, 47570, 49011, 48152, 48923, 49298, 45616, 49838, 56289, 48531, 54889, 28037, 27951, 28030, 28029, 36760, 41028, 52399, 46416, 47089, 47245, 59126, 46778, 47510, 47544, 45281, 1710, 50350, 50934, 50942, 48955, 50447, 23794, 58812, 57334, 27196, 27209, 53449, 44267, 43777, 44241, 33617, 44421, 43996, 33699, 44017, 44035, 44793, 44740, 44045, 41896, 45934, 37788, 46081, 45718, 34906, 36833, 51580, 36102, 36640, 38472, 38512, 38168, 38192, 58176, 37143, 33778, 35102, 38633, 50957, 50673, 49247, 33993, 48983, 29281, 41161, 40115, 40015, 40934, 40943, 34678, 34294, 34310, 35453, 35470, 56308, 48744, 45875, 48772, 43009, 45155, 46039, 27817, 27646, 27765, 27768, 28053, 28091, 28083, 52312, 46083, 58048, 52274, 51710, 48730, 48143, 47322, 48500, 45800, 27645, 27712, 52435, 49004, 46571, 46603, 46714, 46691, 47250, 42407, 46522, 46692, 46710, 50352, 51172, 50766, 48653, 27219, 27550, 27365, 27327, 60930, 54045, 51108, 46629, 60680, 26219, 53110, 44060, 44674, 43617, 43629, 43658, 45269, 45978, 45412, 45657, 45670, 45553, 35999, 36630, 36668, 36353, 36381, 38918, 38616, 58921, 36818, 42996, 42445, 43049, 39648, 29952, 29967, 29024, 29203, 40160, 39983, 34894, 34548, 35553, 48881, 49482, 48874, 49542, 55452, 27804, 27659, 53146, 51940, 50809, 42695, 47067, 46648, 47693, 47208, 46952, 36436, 50783, 50442, 50512, 50498, 49775, 58891, 58579, 48514, 51778, 60381, 27524, 38441, 59009, 26251, 44644, 61380, 43725, 43416, 45149, 44169, 44192, 44237, 45150, 57075, 45472, 45451, 43919, 45906, 44772, 46975, 57057, 59017, 36515, 36551, 36316, 37242, 35966, 35944, 38614, 38639, 57079, 59893, 41961, 59719, 33455, 29994, 30005, 27795, 29798, 29288, 29069, 29294, 40520, 35435, 35404, 33501, 60677, 34801, 34818, 34651, 34262, 49750, 49113, 49322, 49335, 58016, 46474, 48610, 49549, 49249, 47355, 46725, 48949, 49303, 24372, 26620, 46106, 51062, 50160, 27669, 27822, 51981, 50675, 50680, 52434, 46576, 47106, 46528, 46412, 50456, 50351, 50642, 49191, 49811, 50408, 47927, 50480, 46816, 25780, 58180, 27076, 27191, 27558, 27141, 27501, 54429, 46656, 60850, 44746, 43691, 36034, 44197, 43784, 43950, 44350, 44383, 43395, 43432, 44311, 44167, 45792, 45838, 36048, 45417, 45893, 41554, 48142, 36059, 36035, 36775, 35902, 35914, 36604, 36620, 35898, 33648, 36837, 48688, 36629, 37236, 38336, 38348, 34549, 53425, 41333, 39515, 42024, 43099, 35131, 42694, 60857, 42957, 41438, 60068, 60127, 34056, 29859, 29998, 29955, 29270, 29291, 40258, 39670, 56416, 40035, 40559, 37155, 34836, 34838, 34839, 34840, 34848, 34990, 34918, 35459, 33800, 34665, 35165, 35217, 49258, 49059, 49073, 49074, 49504, 48686, 48708, 36441, 45852, 39006, 43125, 28042, 27981, 27282, 31857, 28157, 27994, 27954, 28149, 31137, 31166, 43792, 47235, 48096, 49783, 50748, 46837, 50108, 39802, 50304, 23299, 22834, 61755, 25806, 50992, 27348, 27340, 27143, 43604, 44104, 44123, 43956, 44111, 44432, 39527, 44794, 44418, 43713, 43362, 45864, 45190, 36412, 57070, 38048, 35356, 57062, 38920, 37617, 36602, 42259, 43126, 29958, 29209, 29260, 40454, 40560, 39938, 40024, 34962, 34932, 35195, 34883, 35335, 49198, 47883, 48538, 37353, 49167, 24417, 57493, 55503, 27831, 27716, 28067, 27802, 27966, 27650, 50948, 46477, 46835, 46500, 46521, 46263, 46269, 46666, 46382, 47402, 46641, 46759, 48789, 50517, 50424, 50584, 59243, 59078, 51962, 56271, 56277, 55662, 27845, 27979, 28035, 51744, 52377, 43454, 47405, 47680, 46717, 46734, 46799, 46888, 46657, 50742, 50563, 50372, 50269, 38963, 50362, 33749, 35909, 38976, 50947, 51060, 50109, 59250, 27555, 27553, 27377, 49844, 54010, 54119, 34571, 44265, 44741, 44200, 44243, 43705, 43736, 44324, 34718, 45743, 45454, 45464, 45847, 50344, 35839, 36670, 35942, 35987, 36628, 58903, 38358, 39449, 29922, 29878, 29943, 29889, 29857, 29970, 29212, 29033, 29169, 29059, 38551, 38596, 40774, 61493, 35032, 33660, 48839, 48432, 49552, 48552, 49147, 49219, 48996, 48150, 49266, 48967, 56846, 57563, 55483, 28162, 28072, 27788, 51783, 47060, 44612, 37895, 45653, 47563, 46461, 46517, 41320, 47144, 51001, 51009, 50663, 49792, 50896, 50334, 49865, 51178, 51261, 23239, 58217, 27431, 27505, 27461, 27427, 60610, 57587, 51167, 44309, 41238, 44113, 44745, 36502, 43338, 45051, 45053, 45059, 44219, 45145, 56553, 41671, 43295, 35237, 45601, 45462, 46831, 45651, 40966, 36117, 36134, 38459, 36616, 38349, 46953, 38513, 38915, 42063, 41569, 59540, 59699, 33922, 29868, 29924, 29870, 29167, 27703, 29028, 29160, 29138, 29018, 40800, 39831, 40006, 34466, 35162, 34449, 35210, 50932, 49346, 48370, 46201, 48800, 57178, 49453, 48961, 27656, 27838, 28090, 28116, 46777, 38308, 44627, 47692, 38248, 35063, 35723, 50104, 50121, 50129, 49806, 50672, 51358, 51124, 50570, 50418, 25269, 27383, 27445, 44743, 44756, 44423, 43448, 46917, 45483, 36334, 35562, 36495, 35981, 38122, 38136, 41077, 38383, 37390, 41667, 41856, 42325, 41612, 41358, 59653, 33490, 33929, 30802, 30791, 30708, 52515, 29840, 29214, 29064, 41053, 39865, 39921, 40882, 57336, 40143, 40040, 40795, 35105, 34546, 35712, 35276, 32921, 34767, 49525, 45597, 44151, 52476, 24313, 41931, 53660, 51979, 51991, 56701, 50886, 27773, 27746, 27911, 27754, 47120, 46556, 47108, 46795, 47236, 44812, 38157, 47260, 50373, 49813, 50371, 50787, 38970, 60647, 22292, 54086, 58832, 54331, 56010, 50496, 44428, 44676, 44591, 40607, 44146, 44557, 44637, 44238, 44320, 44748, 44681, 46008, 34280, 35882, 34610, 36730, 53267, 37739, 42383, 37322, 37546, 37538, 38413, 41409, 42440, 38388, 29935, 29919, 29849, 29279, 29164, 29087, 29245, 29241, 29141, 39733, 39455, 40004, 40798, 35218, 34720, 34780, 34810, 34341, 34957, 35286, 57710, 34902, 49617, 60330, 60400, 26401, 59029, 43366, 45139, 45839, 44055, 44048, 44232, 43500, 43812, 43922, 44168, 45188, 43650, 43803, 41678, 45737, 45738, 45455, 42037, 36237, 36850, 35880, 34783, 34736, 37688, 60548, 37944, 38924, 37098, 42258, 36405, 58837, 58688, 57059, 43178, 36395, 50884, 33649, 33484, 29873, 57845, 22261, 22266, 22740, 28894, 36814, 39882, 39958, 34356, 34671, 35207, 33685, 35186, 33461, 33669, 48397, 48907, 48911, 38315, 48559, 57035, 57277, 28073, 27949, 27865, 27722, 51741, 50365, 46671, 58947, 45859, 45861, 46744, 46745, 50822, 48700, 50446, 50924, 51106, 38966, 26027, 27225, 27522, 61468, 44701, 44245, 43934, 44257, 43765, 44059, 44496, 60094, 43728, 45904, 45744, 45746, 45850, 44691, 57901, 45710, 45706, 36447, 36461, 36471, 57746, 34797, 35781, 57273, 33522, 35860, 35884, 36480, 37101, 59202, 38649, 37380, 42378, 42385, 42448, 41313, 41300, 41987, 41541, 40197, 35473, 42521, 41508, 48872, 48890, 33493, 33998, 30007, 29877, 29929, 29985, 29832, 29932, 29248, 40958, 40970, 40767, 37884, 39309, 40025, 39862, 40676, 35466, 35314, 33597, 58708, 34417, 49329, 48794, 48702, 48704, 49354, 48720, 27943, 27895, 28108, 51804, 52761, 47094, 47095, 46724, 46747, 42299, 47115, 47404, 47022, 50810, 50518, 51025, 50653, 48639, 50264, 29981, 27432, 27310, 60521, 25913, 26755, 28936, 46756, 44581, 44235, 44256, 43662, 43963, 44051, 43834, 47912, 43898, 43337, 43424, 43005, 44191, 43924, 45727, 42944, 47496, 35967, 36413, 59013, 36387, 35852, 35447, 36769, 3905, 36845, 36667, 38331, 37919, 42252, 36303, 41666, 41973, 41601, 59995, 33877, 57157, 29823, 29853, 23132, 23241, 40996, 40254, 35112, 39765, 40851, 60689, 34333, 57908, 35107, 49234, 48263, 48627, 48350, 60536, 42664, 57150, 53865, 27808, 27858, 27998, 27902, 27941, 52533, 51923, 47440, 46446, 46967, 47098, 49871, 47256, 47473, 46440, 50278, 38951, 51115, 49784, 51438, 49866, 47532, 50157, 58928, 27329, 27261, 60593, 61739, 60942, 60895, 33819, 52995, 54521, 54241, 54288, 54185, 44115, 44638, 44043, 44072, 42794, 44470, 44046, 44224, 44240, 41718, 43372, 43906, 46009, 53162, 35360, 45443, 45379, 45693, 45474, 45487, 45678, 46370, 59099, 34106, 36575, 38747, 38347, 38361, 38950, 38179, 42468, 41563, 59760, 59667, 59500, 59514, 56141, 32854, 29928, 22767, 29066, 29262, 40164, 39703, 39716, 37149, 40991, 40479, 39083, 40446, 41141, 40167, 34809, 34852, 34340, 35211, 35248, 34754, 47076, 47376, 48632, 49282, 49287, 49275, 49280, 49006, 49241, 49027, 49190, 48974, 49176, 27742, 27914, 52928, 52882, 44549, 47413, 47417, 47005, 44625, 47458, 50740, 50719, 50712, 50723, 50785, 50492, 50466, 50576, 52938, 44587, 44677, 43959, 45048, 55988, 43702, 44425, 45697, 33506, 35692, 57123, 35728, 36305, 34222, 37622, 37413, 60352, 34180, 36265, 41814, 53630, 41211, 57027, 29903, 29966, 29844, 29847, 29908, 29906, 29221, 29266, 29094, 40885, 40643, 36224, 39772, 39735, 35239, 35178, 35254, 34186, 34816, 34345, 35445, 48564, 48345, 48777, 49057, 49180, 49061, 48293, 48133, 60730, 49121, 58990, 22726, 24547, 52989, 27810, 28098, 27908, 27796, 27936, 27971, 27791, 27850, 53136, 60533, 52655, 50353, 47262, 47291, 46675, 47163, 50603, 51044, 58972, 50938, 50416, 50521, 22671, 32489, 34166, 31590, 31639, 50952, 60457, 44176, 43678, 43739, 55974, 45046, 44117, 44688, 44031, 44054, 34060, 41991, 43591, 44053, 44797, 44052, 43954, 45456, 55514, 39529, 45885, 41979, 43972, 36681, 35809, 40127, 35895, 36869, 39262, 34228, 37910, 37670, 37822, 37817, 42109, 49286, 42103, 41947, 59650, 35052, 29927, 29890, 29054, 29175, 39706, 52409, 39292, 39775, 35448, 34533, 50699, 48037, 48550, 50920, 49032, 49277, 49076, 49069, 56247, 56456, 34649, 57226, 60340, 28160, 28100, 46515, 47171, 47258, 46570, 43634, 50420, 27325, 48852, 60681, 43836, 44369, 44377, 44109, 44752, 44749, 44247, 44665, 43845, 44092, 43717, 44693, 43955, 44550, 57689, 43694, 46082, 45704, 46011, 57256, 36287, 36120, 35965, 57636, 38884, 34472, 38999, 59546, 43108, 43000, 42119, 42171, 55336, 59780, 29837, 29268, 29225, 39016, 34414, 35092, 34330, 34580, 46996, 34293, 57044, 50085, 34513, 35188, 58338, 35214, 49378, 49385, 47337, 49125, 48638, 49462, 41758, 48609, 54910, 57008, 44730, 54675, 27878, 28131, 28049, 52891, 47132, 46472, 57797, 46929, 47113, 47294, 46558, 46732, 50565, 49152, 51119, 48481, 58942, 25823, 25792, 27267, 17009, 27530, 26318, 26228, 43557, 42021, 44122, 44510, 37243, 42837, 44264, 44698, 44708, 45535, 35805, 35811, 36352, 36096, 36178, 38912, 42974, 36163, 42369, 41516, 34813, 41694, 41706, 59542, 59617, 29826, 29923, 29887, 29812, 29950, 22611, 22229, 29145, 29015, 40640, 40021, 41103, 40028, 40569, 40832, 35050, 34817, 35089, 47905, 47931, 47351, 48691, 49262, 48264, 48562, 49005, 56196, 56145, 59085, 56816, 56820, 57181, 44089, 43681, 27794, 28110, 27922, 28076, 27736, 27884, 48183, 46649, 33873, 41431, 39346, 45938, 47017, 46976, 50548, 50566, 50450, 50491, 51265, 25911, 25896, 27222, 27548, 27244, 41967, 60686, 36726, 42578, 38065, 33738, 33741, 47556, 29960, 29953, 39952, 40111, 39299, 35160, 34688, 49141, 47333, 49537, 47875, 48895, 49181, 49367, 48545, 41811, 55710, 55715, 55720, 58475, 27875, 27819, 28134, 27891, 28145, 50516, 47370, 38538, 46790, 41365, 47249, 59131, 47644, 46962, 46627, 47475, 46674, 41564, 50298, 50435, 50465, 50486, 48828, 48863, 41290, 51284, 49885, 50964, 38971, 50571, 23925, 59344, 27526, 27518, 54276, 44426, 44584, 44589, 44680, 44579, 40657, 43407, 33940, 44325, 49172, 44236, 44427, 45323, 45493, 36077, 57298, 36860, 58934, 36666, 57227, 37653, 41755, 34769, 42536, 42514, 58875, 58877, 35091, 59516, 29913, 41072, 35174, 40508, 35077, 59468, 33814, 34819, 58663, 58669, 48502, 48540, 47449, 48810, 49251, 49257, 49567, 48941, 49457, 55824, 27814, 27946, 27800, 27937, 49873, 51442, 52741, 47436, 47237, 35538, 47042, 47038, 46736, 57882, 50354, 50569, 59284, 27419, 35104, 59457, 44124, 44585, 43932, 44020, 44165, 44933, 44569, 44533, 43628, 43607, 45429, 45542, 36564, 36652, 35444, 38284, 22639, 23033, 37626, 37619, 34626, 34667, 41621, 42360, 42663, 42679, 42047, 43154, 36355, 41620, 59551, 59658, 59748, 29904, 29831, 29875, 11352, 29271, 35451, 50432, 51161, 35073, 35333, 35436, 35418, 35533, 48633, 48642, 49150, 48145, 49194, 48734, 48157, 48185, 47866, 48513, 52981, 55623, 57025, 55019, 27985, 31131, 52014, 47390, 37780, 47195, 47300, 50455, 50404, 50490, 58871, 27353, 22543, 45030, 44326, 44689, 43539, 44242, 43953, 38476, 43751, 43710, 45853, 45560, 35886, 35873, 36851, 46403, 41817, 43146, 41659, 42570, 42874, 41810, 59603, 29894, 29912, 29251, 40340, 39939, 39870, 40137, 35446, 34680, 35454, 49202, 42603, 47780, 47711, 49123, 49040, 56484, 57534, 27916, 27976, 27974, 28085, 36650, 36664, 51794, 53059, 47634, 46408, 43839, 46555, 47384, 44624, 46542, 46789, 48945, 47447, 47463, 47459, 50739, 50402, 50497, 27544, 27543, 57046, 52756, 44393, 43964, 43957, 43828, 44835, 44419, 44578, 43801, 44239, 44322, 61687, 45771, 45786, 45887, 36619, 35813, 37672, 37441, 37461, 38795, 38848, 37420, 48808, 42148, 41533, 59595, 54257, 59730, 33708, 57128, 40900, 33038, 29975, 29222, 29029, 40957, 40674, 40200, 34016, 35400, 34980, 35386, 35457, 57306, 48963, 49264, 49337, 48579, 48951, 56351, 55323, 28087, 28161, 28040, 37490, 59778, 38916, 35026, 37422, 38914, 42485, 41683, 55782, 42736, 49153, 38055, 42097, 39506, 59656, 33820, 29930, 29843, 29189, 29129, 35288, 40372, 58907, 39790, 37161, 34622, 40537, 39892, 40371, 34945, 34642, 34189, 35311, 48755, 47901, 47910, 48902, 48846, 49207, 46959, 55303, 48729, 47872, 48546, 52481, 57032, 57088, 27714, 27980, 28000, 27737, 27723, 52288, 46575, 46642, 46973, 43778, 39406, 51195, 48817, 50403, 50423, 47877, 50468, 49786, 23360, 27551, 27243, 27440, 53620, 55154, 44440, 44781, 43946, 43884, 43908, 44742, 44044, 43498, 57165, 57146, 45385, 46088, 45392, 45404, 46868, 58082, 36516, 40561, 38371, 41691, 41528, 41433, 59526, 35060, 29891, 29227, 29152, 39697, 39704, 39712, 40216, 34117, 40125, 38961, 37789, 34528, 19169, 48155, 55620, 47380, 49755, 48547, 48818, 48980, 47923, 24431, 57065, 54985, 52709, 28075, 27901, 27674, 51736, 43843, 46548, 47577, 50366, 50971, 50122, 50356, 38974, 45327, 50400, 58879, 55080, 27288, 27361, 53932, 53938, 53534, 42260, 44568, 44319, 44744, 34579, 44857, 43763, 44276, 35455, 44942, 38199, 44164, 43360, 44564, 45837, 45958, 46271, 45754, 35928, 36473, 35989, 58096, 38302, 36154, 61230, 59281, 37827, 37681, 38311, 41645, 58884, 42382, 41922, 41935, 42351, 59840, 59986, 29961, 29848, 29846, 29892, 22928, 29284, 29163, 29155, 29172, 40107, 40144, 40281, 40349, 39737, 40979, 59104, 40881, 40714, 60700, 40424, 34558, 47418, 47954, 49226, 49110, 49023, 45148, 57186, 48144, 48950, 48925, 57217, 56916, 49891, 49917, 28125, 27956, 28079, 28156, 27933, 53013, 50949, 46828, 50477, 46644, 49823, 51222, 50392, 49804, 49870, 48703, 58716, 59004, 56871, 25833, 27250, 27187, 54000, 54017, 51203, 54218, 54372, 35433, 45183, 44107, 44213, 44250, 44413, 45584, 45603, 45498, 45628, 45664, 43814, 39536, 36720, 40418, 38655, 37758, 34257, 41402, 59683, 33740, 34476, 29842, 27799, 29769, 28372, 28408, 30305, 29828, 29905, 22195, 22636, 29084, 29195, 39634, 39654, 39978, 34440, 34566, 34061, 34833, 35197, 34878, 35010, 35359, 49227, 49154, 49114, 49160, 49331, 43660, 48751, 57775, 46645, 27929, 27782, 28094, 53753, 52422, 52916, 52344, 59251, 47465, 46771, 47056, 47209, 47282, 46788, 51223, 51233, 38975, 50731, 39555, 50749, 50388, 40901, 58087, 59261, 27539, 27363, 27533, 53998, 44114, 43310, 44106, 44445, 43840, 44617, 44573, 45514, 59599, 47340, 42281, 41866, 45282, 45490, 42117, 58137, 36258, 36431, 38298, 38306, 53119, 34727, 37151, 44172, 54063, 54082, 44747, 43914, 44679, 44675, 43832, 44321, 44875, 44754, 43896, 44686, 59756, 46144, 45247, 36082, 36176, 36396, 38619, 38761, 42087, 42244, 38350, 41539, 59869, 30010, 39858, 57148, 39343, 39877, 37082, 35236, 34803, 34314, 35169, 35302, 47080, 48762, 49444, 48790, 46899, 56207, 57258, 27879, 27871, 38680, 50682, 46669, 47517, 47383, 46480, 51133, 33478, 50474, 50383, 50433, 49818, 37136, 50616, 58838, 25782, 27215, 27203, 54422, 54112, 53942, 58825, 50524, 53895, 54245, 58816, 51384, 52333, 44291, 44127, 44137, 60399, 39597, 44065, 43991, 44934, 44503, 44233, 43754, 44249, 37819, 44643, 45841, 36579, 36783, 36648, 38329, 38282, 38295, 37862, 41047, 41889, 43179, 43185, 33495, 33575, 29982, 29041, 29037, 29149, 29025, 39664, 40257, 40353, 39483, 39499, 60509, 34159, 34798, 33321, 34930, 34328, 35415, 34924, 34895, 34627, 49108, 49129, 48151, 48153, 48455, 53224, 58354, 27997, 27821, 46823, 46877, 46678, 47297, 46579, 47031, 44984, 46866, 47367, 50343, 50626, 46923, 50967, 50770, 23416, 59263, 58593, 27453, 27536, 26210, 26301, 44105, 44672, 44595, 44327, 45983, 43962, 43833, 44588, 40206, 39181, 45328, 45334, 47093, 36500, 36585, 36556, 35994, 36058, 42154, 36132, 37123, 38249, 57106, 38917, 34917, 37594, 37077, 38404, 41369, 42859, 59494, 59492, 33944, 33599, 22706, 40485, 40757, 40887, 40903, 40684, 40407, 40416, 38620, 40153, 40193, 47533, 57073, 34898, 35247, 35326, 57780, 34520, 34689, 35481, 57919, 34374, 46694, 46697, 48827, 44506, 49058, 49118, 47832, 49070, 48667, 47891, 47471, 24407, 24409, 44981, 45042, 57478, 27711, 27866, 27756, 52969, 47677, 43952, 47134, 46712, 49794, 51259, 59252, 53925, 25908, 41360, 44594, 53160, 44414, 44831, 44671, 45324, 46170, 46297, 46465, 34250, 39894, 35960, 36138, 38191, 37303, 48804, 41828, 41351, 41361, 39203, 39470, 41517, 59803, 59704, 59759, 30056, 29874, 29872, 40617, 40535, 39954, 49342, 49008, 48904, 48740, 56151, 56335, 57055, 28114, 28092, 27989, 27653, 50991, 52825, 52802, 53213, 47228, 46761, 46773, 46598, 44605, 46982, 49887, 47476, 47107, 47583, 50357, 49789, 50415, 50367, 50115, 50441, 50394, 50483, 27450, 27389, 27508, 27513, 27436, 54115, 54015, 54023, 43298, 44853, 44887, 44110, 44299, 44263, 36663, 43867, 47349, 44246, 43949, 44769, 45932, 59693, 46113, 46308, 45716, 45722, 34211, 34214, 34225, 36697, 35119, 34335, 36846, 36317, 34746, 39399]
    calls = pydash.map_(token_ids, lambda td: {
        'target': UNIV3_NFT_ADDRSS,
        'params': td,
    })
    res = multi_call(calls, univ3_abi, chain='Polygon', block=25210983)
    print(res)


if __name__ == '__main__':
    # multicall()
    multicall_v2()
    # multicall_v3()
    # multicall_v4()
    # decode_single('((bool,bytes)[])', output)
